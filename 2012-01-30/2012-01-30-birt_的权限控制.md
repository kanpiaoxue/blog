#birt 的权限控制
###发表时间：2012-01-30
###分类：birt
###iteye原始地址：<a href="https://kanpiaoxue.iteye.com/admin/blogs/1386103" target="_blank">https://kanpiaoxue.iteye.com/admin/blogs/1386103</a>

---

<p><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">很多兄弟问到birt的权限控制问题，我这里只是简单的说两个方法，而且是很简单的方法，实际操作中可能不是太实用。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">第一种方法通过参数控制：</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">页面报表就是一个简单的报表，这里我是太偷懒了。嘿嘿。 只有个参数，接收前台传进来的数据。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span id="att_380" class="f12" style="color: #333333; font-family: Arial; line-height: 21px;"><span id="td_att380" class="J_attImg" style="display: inline-block;"><img style="border-color: initial;" src="http://www.birthome.cn/attachment/Mon_1004/10_2_454786e77a60001.png?2" border="0" alt=""></span></span><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&nbsp;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">报表如上图添加两个标签，一个标签普通用户可以查看，另一个标签管理员可以查看。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">设置标签的隐藏性。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">隐藏代码：</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">if(params["user"].value=='user'){ &nbsp; //如果参数值为user,则显示。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&nbsp;false;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">}else{</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">true;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">}</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">关于隐藏性论坛有太多的教程了，自己搜索一下吧。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">然后我们看页面代码：</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;div&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;!-- 显示角色选择列表 --&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;select name='s1'&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;option value='user'&gt;普通用户&lt;/option&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;option value='admin'&gt;管理员&lt;/option&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;/select&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;/div&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;div&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;!-- 显示报表的iframe --&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;iframe id="iframe1" style='width:600px;height:500px;border:1px solid gray;'&gt;&lt;/iframe&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;/div&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">_showReport方法：</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">function _showReport(s){</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">var url="/birt2.3/preview?__report=/report/birthome/role1.rptdesign&amp;user="+s.value;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">document.getElementById('iframe1').src=url;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">}</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">这里我想说一下，那个角色列表，我们在实际操作中，最后是通过后台得到一个角色列表。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">运行结果如下：</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span id="att_381" class="f12" style="color: #333333; font-family: Arial; line-height: 21px;"><span id="td_att381" class="J_attImg" style="display: inline-block;"><img style="border-color: initial;" src="http://www.birthome.cn/attachment/Mon_1004/10_2_72d8ba0709a81e6.png?6" border="0" alt=""></span></span><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&nbsp;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">第二种方法通过session的数据来处理。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">先看一下页面。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;div&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;input type='button' value='显示报表'&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;/div&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;div&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;iframe id="iframe1" style='width:600px;height:500px;border:1px solid gray;'&gt;&lt;/iframe&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;/div&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">_showReport()的代码如下：</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">function _showReport(){</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">var url="/birt2.3/preview?__report=/report/birthome/role2.rptdesign&amp;__parameterpage=false";</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">document.getElementById('iframe1').src=url;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">}</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">当然这里，我们是通过之前保存在session里的用户数据判断的，我把这个代码写在了jsp里，如下：</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&lt;%</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">request.getSession().setAttribute("user","admin");</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">%&gt;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">我们再看一下报表：</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">还是上面的报表，不过在报表的beforeFactory里加了以下的代码</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">importPackage(Packages.org.eclipse.equinox.http.servlet.internal); &nbsp; //导入相关的类，其实这里是导入了包，你会发现，其实这个request和session并不是我们以为的request和session.&nbsp;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">var request = reportContext.getHttpServletRequest();</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">session = request.getSession();</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">var user = session.getAttribute("user");</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">reportContext.setParameterValue("user",user); &nbsp; //改变参数的值。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">上面其实没什么，得到request，得到session,其实重要的是发现这个request是哪个类，通过getHttpServletRequest这个名字我一开始以为是HttpservletRequest所以操作总出错。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">运行效果大概就这样：</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span id="att_382" class="f12" style="color: #333333; font-family: Arial; line-height: 21px;"><span id="td_att382" class="J_attImg" style="display: inline-block;"><img style="border-color: initial;" src="http://www.birthome.cn/attachment/Mon_1004/10_2_68143b01fada841.png?3" border="0" alt=""></span></span><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&nbsp;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">我相关的文件附上，省得出现一些其他问题。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span id="att_384" class="f12" style="color: #333333; font-family: Arial; line-height: 21px;"><strong style="font-weight: 700;"></strong><img style="border-color: initial;" src="http://www.birthome.cn/images/wind85/file/zip.gif" alt="" align="absbottom"><a style="text-decoration: none; color: #0070af;" href="http://www.birthome.cn/job.php?action=download&amp;aid=384">&nbsp;role.rar</a>&nbsp;(4 K) 下载次数:33&nbsp;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">注意一下目录结构。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span id="att_383" class="f12" style="color: #333333; font-family: Arial; line-height: 21px;"><span id="td_att383" class="J_attImg" style="display: inline-block;"><img style="border-color: initial;" src="http://www.birthome.cn/attachment/Mon_1004/10_2_893d4da05b76d7f.png?6" border="0" alt=""></span></span><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">&nbsp;</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">另外说一下，运行的时候，控制台会报个：</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">Unable to find required classes (javax.activation.DataHandler and javax.mail.internet.MimeMultipart). Attachment support is disabled.</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">这可能webviewer在哪里使用了javamial,加上javamail的包就行了。</span><br style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;"><span style="color: #333333; font-family: Arial; font-size: 14px; line-height: 21px;">一个是mail.jar,一个是activation-1.1.jar</span></p>
<p>&nbsp;</p>
<p>[注明] 转载自：&nbsp;<a href="http://www.birthome.cn/read.php?tid-1119.html">http://www.birthome.cn/read.php?tid-1119.html</a></p>