#java语言时间表达式引擎
###发表时间：2015-06-04
###分类：java,DateTime,Joda-Time,经验
###iteye原始地址：<a href="https://kanpiaoxue.iteye.com/admin/blogs/2217121" target="_blank">https://kanpiaoxue.iteye.com/admin/blogs/2217121</a>

---

<div class="iteye-blog-content-contain" style="font-size: 14px;"> 
 <p>自己用的一个需要解析时间格式表达式的小工具类：</p> 
 <p>&nbsp;</p> 
 <pre name="code" class="java">/**
 * &lt;pre&gt;
 * Copyright CDC [2000-2015]
 * &lt;/pre&gt;
 */
package org.kanpiaoxue.commons.utils;

import org.apache.commons.lang3.StringUtils;
import org.joda.time.DateTime;
import org.joda.time.format.DateTimeFormat;
import org.joda.time.format.DateTimeFormatter;

import com.google.common.base.Preconditions;
import com.google.common.base.Splitter;
import com.google.common.collect.Maps;

import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * &lt;pre&gt;
 * DateExpressionEngine.java
 * @author kanpiaoxue&lt;br&gt;
 * @version 1.0
 * Create Time 2015年6月4日 下午7:16:02&lt;br&gt;
 * Description : 时间表达式引擎
 * &lt;/pre&gt;
 */
public class DateExpressionEngine {

    /**
     * &lt;pre&gt;
     * @param needProcessString 需要处理的字符串
     *  里面可以含有任意多个时间表达式
     *  格式：dateFormat[,offset]}
     *  dateFormat: 符合java的java.text.DateFormat规范的表达式
     *  DateUnit 时间格式单位:[注意大小写]
     *      y   :   year
     *      M   :   Month
     *      d   :   day
     *      w   :   week
     *      H   :   Hour
     *      m   :   minute
     *
     *  [重点]这里的格式有两种，一种是一般日期表达式，一种是特殊表达式
     *
     *  一、一般日期表达式：
     *  offset的表达式：(-)?number+DateUnit
     *  offset的正则表达式： ^((?:-)?\\d+?)([y,M,w,d,H,m])$
     *
     *   example:
     *      ${MM} ${MMdd} ${MM/dd} ${HH} ${HHmm}
     *      ${yyyyMMdd} ${yyyy-MM-dd} ${yyyy/MM/dd}
     *      ${yyyyMMddHH} ${yyyy-MM-dd HH} ${yyyy/MM/dd HH}
     *      ${yyyyMMddHHmm} ${yyyy-MM-dd HH:mm} ${yyyy/MM/dd HH:mm}
     *      ${yyyyMMdd,-1y} ${yyyy-MM-dd,-1y} ${yyyy/MM/dd,-1y}
     *      ${yyyyMMdd,-1M} ${yyyy-MM-dd,-1M} ${yyyy/MM/dd,-1M}
     *      ${yyyyMMdd,1d} ${yyyy-MM-dd,1d} ${yyyy/MM/dd,1d}
     *      ${yyyyMMddHH,1H} ${yyyy-MM-dd HH,1H} ${yyyy/MM/dd HH,1H}
     *      ${yyyyMMdd,1w} ${yyyy-MM-dd,1w} ${yyyy/MM/dd,1w}
     *      ${yyyyMMddHHmm,10m} ${yyyy-MM-dd HH:mm,10m} ${yyyy/MM/dd HH:mm,10m}
     *
     * 二、特殊表达式
     *  用来计算：季度初/末，月初/末，周初/末（也就是周一和周日）
     *  offset的表达式：position+DateUnit
     *  offset的正则表达式：^([F,f,E,e])([M,w,W,q,Q])$
     *  ------------------
     *  F,f means: first
     *  E,e means: end
     *  ------------------
     *  M : Month
     *  w,W : Week
     *  q,Q : Quarter
     *
     * @param dateValue 时间的字符串，格式要求 yyyyMMdd,yyyyMMddHH,yyyyMMddHHmm
     * @return 经过计算之后的字符串
     * &lt;/pre&gt;
     */
    public static String formatDateExpression(String needProcessString, String dateValue) {
        Preconditions.checkArgument(StringUtils.isNotBlank(needProcessString));
        Preconditions.checkArgument(StringUtils.isNotBlank(dateValue));
        Preconditions.checkArgument(DATE_PATTERN.matcher(dateValue).matches(),
                "dateValue is unexpect format:%s. "
                        + "Required min length is 8, like : 20150101. %s's length is : %s", dateValue,
                        dateValue, dateValue.length());

        Matcher m = PATTERN.matcher(needProcessString);
        /**
         * 如果找到时间表达式则进行替换，如果找不到，则不进行处理
         */
        while (m.find()) {
            String expression = m.group(2);
            /**
             * &lt;pre&gt;
             * ${expression} is group(1) , as:  ${yyyyMMdd,-1y} , ${yyyyMMdd,FQ}
             * expression is group(2) , as: yyyyMMdd,-1y , yyyyMMdd,FQ
             * &lt;/pre&gt;
             */
            int start = m.start(1);
            int end = m.end(1);
            // expressionWrapper : ${yyyyMMdd,-1y} , ${yyyyMMdd,FQ}
            String expressionWrapper = needProcessString.substring(start, end);
            // replaceMent : 20150101 201501012359
            // 得到正确的时间字符串
            String replaceMent = getCorrectDateString(expression, dateValue);
            // 替换表达式为正确的时间字符串
            needProcessString = StringUtils.replace(needProcessString, expressionWrapper, replaceMent);
            // find next
            m = PATTERN.matcher(needProcessString);
        }
        return needProcessString;
    }

    private static String getCorrectDateString(String express, String dataVersionNo) {
        // 将表达式切分开
        List&lt;String&gt; lst = Splitter.on(',').trimResults().omitEmptyStrings().splitToList(express);
        int size = lst.size();
        Preconditions.checkArgument(size &lt;= 2, "unexpected expression format:%s", express);
        // 得到世界表达式的格式化部分
        String format = lst.get(0);
        // 将版本号的字符串转换为 DateTime 对象
        DateTime dateTime = parseForDataVersionNo(dataVersionNo);
        DateTime rs = dateTime;
        // 如果存在复杂的计算表达式
        if (lst.size() == 2) {
            String offsetExpression = lst.get(1);
            // 处理季度、月、周的第一天和最后一天
            Matcher sm = OFFSET_SPECIAL_PATTERN.matcher(offsetExpression);
            if (sm.matches()) {
                String str1 = sm.group(1);
                Preconditions.checkArgument(StringUtils.isNotBlank(str1), "unexpected expression format:%s",
                        express);
                String unit = sm.group(2);
                if (QUARTR_STRING.equalsIgnoreCase(unit)) {
                    DateTime startQuarter =
                            dateTime.plusMonths(0 - (dateTime.monthOfYear().get() - 1) % 3).dayOfMonth()
                            .withMinimumValue();
                    // 季度初
                    if (FIRST_STRING.equalsIgnoreCase(str1)) {
                        rs = startQuarter;
                    } else if (END_STRING.equalsIgnoreCase(str1)) {
                        rs = startQuarter.plusMonths(3).plusDays(-1);
                        // 季度末
                    } else {
                        throw new IllegalArgumentException(String.format("unexpected expression format:%s",
                                express));
                    }
                } else if (MONTH_STRING.equals(unit)) {
                    if (FIRST_STRING.equalsIgnoreCase(str1)) {
                        rs = dateTime.dayOfMonth().withMinimumValue();
                    } else if (END_STRING.equalsIgnoreCase(str1)) {
                        rs = dateTime.dayOfMonth().withMaximumValue();
                    } else {
                        throw new IllegalArgumentException(String.format("unexpected expression format:%s",
                                express));
                    }
                } else if (WEEK_STRING.equalsIgnoreCase(unit)) {
                    if (FIRST_STRING.equalsIgnoreCase(str1)) {
                        rs = dateTime.dayOfWeek().withMinimumValue();
                    } else if (END_STRING.equalsIgnoreCase(str1)) {
                        rs = dateTime.dayOfWeek().withMaximumValue();
                    } else {
                        throw new IllegalArgumentException(String.format("unexpected expression format:%s",
                                express));
                    }
                }
                return rs.toString(format);
            }
            // 处理一般的时间表达式
            Matcher m = OFFSET_PATTERN.matcher(offsetExpression);
            Preconditions.checkArgument(m.matches(), "unexpected expression format:%s", express);
            String numString = m.group(1);
            if (StringUtils.isBlank(numString)) {
                numString = "0";
            }
            int num = Integer.valueOf(numString).intValue();
            String unit = m.group(2);
            if (YEAR_STRING.equalsIgnoreCase(unit)) {
                // IgnoreCase
                rs = dateTime.plusYears(num);
            } else if (MONTH_STRING.equals(unit)) {
                rs = dateTime.plusMonths(num);
            } else if (WEEK_STRING.equalsIgnoreCase(unit)) {
                // IgnoreCase
                rs = dateTime.plusWeeks(num);
            } else if (DAY_STRING.equalsIgnoreCase(unit)) {
                // IgnoreCase
                rs = dateTime.plusDays(num);
            } else if (HOUR_STRING.equalsIgnoreCase(unit)) {
                // IgnoreCase
                rs = dateTime.plusHours(num);
            } else if (MINUTE_STRING.equals(unit)) {
                rs = dateTime.plusMinutes(num);
            } else {
                throw new IllegalArgumentException(String.format("unexpected expression format:%s", express));
            }
        }
        return rs.toString(format);
    }

    /**
     * &lt;pre&gt;
     * ======================================== start ========================================
     * &lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
     * &lt;html&gt;
     * &lt;head&gt;
     * &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
     * &lt;title&gt;Insert title here&lt;/title&gt;
     * &lt;/head&gt;
     * &lt;body&gt;
     * &lt;div&gt;
     *
     * 执行命令里面可以含有任意多个时间表达式。&lt;br&gt;
     * 格式：${formatExpression[,offsetExpression]}
     * 其中[]方括号表示“可选”。formatExpression是符合Java的DateFormat的任意格式表达式
     * &lt;span style="color:red;font-weight:bold;"&gt;[注意]区分大小写&lt;/span&gt;
     * &lt;hr&gt;
     * 表达式中的各个字符解释如下：
     * &lt;table border=1&gt;
     * &lt;thead&gt;
     *     &lt;td&gt;字符&lt;/td&gt;
     *     &lt;td&gt;时间单位&lt;/td&gt;
     *     &lt;td&gt;原文&lt;/td&gt;
     *     &lt;td&gt;出现位置&lt;/td&gt;
     * &lt;/thead&gt;
     * &lt;tr&gt;
     * &lt;td&gt;y&lt;/td&gt;
     * &lt;td&gt;年&lt;/td&gt;
     * &lt;td&gt;year&lt;/td&gt;
     * &lt;td&gt;formatExpression,offsetExpression&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;M&lt;/td&gt;
     * &lt;td&gt;月&lt;/td&gt;
     * &lt;td&gt;Month&lt;/td&gt;
     * &lt;td&gt;formatExpression,offsetExpression&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;d&lt;/td&gt;
     * &lt;td&gt;天&lt;/td&gt;
     * &lt;td&gt;day&lt;/td&gt;
     * &lt;td&gt;formatExpression,offsetExpression&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;H&lt;/td&gt;
     * &lt;td&gt;小时&lt;/td&gt;
     * &lt;td&gt;Hour&lt;/td&gt;
     * &lt;td&gt;formatExpression,offsetExpression&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;m&lt;/td&gt;
     * &lt;td&gt;分钟&lt;/td&gt;
     * &lt;td&gt;minute&lt;/td&gt;
     * &lt;td&gt;formatExpression,offsetExpression&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;W&lt;/td&gt;
     * &lt;td&gt;周&lt;/td&gt;
     * &lt;td&gt;Week&lt;/td&gt;
     * &lt;td&gt;offsetExpression&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;Q&lt;/td&gt;
     * &lt;td&gt;季度&lt;/td&gt;
     * &lt;td&gt;Quarter&lt;/td&gt;
     * &lt;td&gt;offsetExpression&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;F&lt;/td&gt;
     * &lt;td&gt;起始&lt;/td&gt;
     * &lt;td&gt;First&lt;/td&gt;
     * &lt;td&gt;offsetExpression&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;E&lt;/td&gt;
     * &lt;td&gt;结束&lt;/td&gt;
     * &lt;td&gt;End&lt;/td&gt;
     * &lt;td&gt;offsetExpression&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;/table&gt;
     * &lt;hr&gt;
     * 举例如下：
     * &lt;table border=1&gt;
     * &lt;tr&gt;
     *     &lt;td&gt;描述&lt;/td&gt;
     *     &lt;td&gt;表达式&lt;/td&gt;
     *     &lt;td&gt;结果：当前时间是2015-08-10 14:40&lt;/td&gt;
     * &lt;/tr&gt;
     * 2015-08-10 14:40
     *
     * &lt;tr&gt;
     * &lt;td&gt;天&lt;/td&gt;
     * &lt;td&gt;${yyyyMMdd}&lt;br&gt;${yyyy-MM-dd}&lt;br&gt;${yyyy/MM/dd}&lt;br&gt;${dd}&lt;/td&gt;
     * &lt;td&gt;20150810&lt;br&gt;2015-08-10&lt;br&gt;2015/08/10&lt;br&gt;10&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;小时&lt;/td&gt;
     * &lt;td&gt;${yyyyMMddHH}&lt;br&gt;${yyyy-MM-dd HH}&lt;br&gt;${yyyy/MM/dd HH}&lt;br&gt;${HH}&lt;/td&gt;
     * &lt;td&gt;2015081014&lt;br&gt;2015-08-10 14&lt;br&gt;2015/08/10 14&lt;br&gt;14&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;分钟&lt;/td&gt;
     * &lt;td&gt;${yyyyMMddHHmm}&lt;br&gt;${yyyy-MM-dd HH:mm}&lt;br&gt;${yyyy/MM/dd HH:mm}&lt;br&gt;${HHmm}&lt;/td&gt;
     * &lt;td&gt;201508101440&lt;br&gt;2015-08-10 14:40&lt;br&gt;2015/08/10 14:40&lt;br&gt;1440&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;1年前&lt;/td&gt;
     * &lt;td&gt;${yyyyMMdd,-1y}&lt;br&gt;${yyyy-MM-dd,-1y}&lt;br&gt;${yyyy/MM/dd,-1y}&lt;/td&gt;
     * &lt;td&gt;20140810&lt;br&gt;2014-08-10&lt;br&gt;2014/08/10&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;1个月前&lt;/td&gt;
     * &lt;td&gt;${yyyyMMdd,-1M}&lt;br&gt;${yyyy-MM-dd,-1M}&lt;br&gt;${yyyy/MM/dd,-1M}&lt;/td&gt;
     * &lt;td&gt;20150710&lt;br&gt;2015-07-10&lt;br&gt;2015/07/10&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;1周前&lt;/td&gt;
     * &lt;td&gt;${yyyyMMdd,-1W}&lt;br&gt;${yyyy-MM-dd,-1W}&lt;br&gt;${yyyy/MM/dd,-1W}&lt;/td&gt;
     * &lt;td&gt;20150803&lt;br&gt;2015-08-03&lt;br&gt;2015/08/03&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;1天前&lt;/td&gt;
     * &lt;td&gt;${yyyyMMdd,-1d}&lt;br&gt;${yyyy-MM-dd,-1d}&lt;br&gt;${yyyy/MM/dd,-1d}&lt;/td&gt;
     * &lt;td&gt;20150809&lt;br&gt;2015-08-09&lt;br&gt;2015/08/09&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;1小时前&lt;/td&gt;
     * &lt;td&gt;${yyyyMMddHH,1H}&lt;br&gt;${yyyy-MM-dd HH,1H}&lt;br&gt;${yyyy/MM/dd HH,-1H}&lt;br&gt;${HH,-1H}&lt;/td&gt;
     * &lt;td&gt;2015081015&lt;br&gt;2015-08-10 15&lt;br&gt;2015/08/10 13&lt;br&gt;13&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;10分钟前&lt;/td&gt;
     * &lt;td&gt;${yyyyMMddHHmm,-10m}&lt;br&gt;${yyyy-MM-dd HH:mm,-10m}&lt;br&gt;${yyyy/MM/dd HH:mm,-10m}&lt;br&gt;${HH:mm,-10m}&lt;/td&gt;
     * &lt;td&gt;201508101430&lt;br&gt;2015-08-10 14:30&lt;br&gt;2015/08/10 14:30&lt;br&gt;14:30&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;季度第一天&lt;/td&gt;
     * &lt;td&gt;${yyyyMMdd,FQ}&lt;br&gt;${yyyy-MM-dd,FQ}&lt;br&gt;${yyyy/MM/dd,FQ}&lt;/td&gt;
     * &lt;td&gt;20150701&lt;br&gt;2015-07-01&lt;br&gt;2015/07/01&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;季度最后一天&lt;/td&gt;
     * &lt;td&gt;${yyyyMMdd,EQ}&lt;br&gt;${yyyy-MM-dd,EQ}&lt;br&gt;${yyyy/MM/dd,EQ}&lt;/td&gt;
     * &lt;td&gt;20150930&lt;br&gt;2015-09-30&lt;br&gt;2015/09/30&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;月第一天&lt;/td&gt;
     * &lt;td&gt;${yyyyMMdd,FM}&lt;br&gt;${yyyy-MM-dd,FM}&lt;br&gt;${yyyy/MM/dd,FM}&lt;/td&gt;
     * &lt;td&gt;20150801&lt;br&gt;2015-08-01&lt;br&gt;2015/08/01&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;月最后一天&lt;/td&gt;
     * &lt;td&gt;${yyyyMMdd,EM}&lt;br&gt;${yyyy-MM-dd,EM}&lt;br&gt;${yyyy/MM/dd,EM}&lt;/td&gt;
     * &lt;td&gt;20150831&lt;br&gt;2015-08-31&lt;br&gt;2015/08/31&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;周一&lt;/td&gt;
     * &lt;td&gt;${yyyyMMdd,FW}&lt;br&gt;${yyyy-MM-dd,FW}&lt;br&gt;${yyyy/MM/dd,FW}&lt;/td&gt;
     * &lt;td&gt;20150810&lt;br&gt;2015-08-10&lt;br&gt;2015/08/10&lt;/td&gt;
     * &lt;/tr&gt;
     * &lt;tr&gt;
     * &lt;td&gt;周日&lt;/td&gt;
     * &lt;td&gt;${yyyyMMdd,EW}&lt;br&gt;${yyyy-MM-dd,EW}&lt;br&gt;${yyyy/MM/dd,EW}&lt;/td&gt;
     * &lt;td&gt;20150816&lt;br&gt;2015-08-16&lt;br&gt;2015/08/16&lt;/td&gt;
     * &lt;/tr&gt;
     *
     *
     * &lt;/table&gt;
     * &lt;/div&gt;
     * &lt;/body&gt;
     * &lt;/html&gt;
     * ======================================== end ========================================
     * &lt;/pre&gt;
     */
    public static void main(String[] args) {
        /**
         * &lt;pre&gt;
         * 用于生成说明文档
         * &lt;/pre&gt;
         */
        Map&lt;String, String&gt; map = Maps.newLinkedHashMap();
        map.put("天", "${yyyyMMdd}&lt;br&gt;${yyyy-MM-dd}&lt;br&gt;${yyyy/MM/dd}&lt;br&gt;${dd}");
        map.put("小时", "${yyyyMMddHH}&lt;br&gt;${yyyy-MM-dd HH}&lt;br&gt;${yyyy/MM/dd HH}&lt;br&gt;${HH}");
        map.put("分钟", "${yyyyMMddHHmm}&lt;br&gt;${yyyy-MM-dd HH:mm}&lt;br&gt;${yyyy/MM/dd HH:mm}&lt;br&gt;${HHmm}");
        map.put("1年前", "${yyyyMMdd,-1y}&lt;br&gt;${yyyy-MM-dd,-1y}&lt;br&gt;${yyyy/MM/dd,-1y}");
        map.put("1个月前", "${yyyyMMdd,-1M}&lt;br&gt;${yyyy-MM-dd,-1M}&lt;br&gt;${yyyy/MM/dd,-1M}");
        map.put("1周前", "${yyyyMMdd,-1W}&lt;br&gt;${yyyy-MM-dd,-1W}&lt;br&gt;${yyyy/MM/dd,-1W}");
        map.put("1天前", "${yyyyMMdd,-1d}&lt;br&gt;${yyyy-MM-dd,-1d}&lt;br&gt;${yyyy/MM/dd,-1d}");
        map.put("1小时前", "${yyyyMMddHH,1H}&lt;br&gt;${yyyy-MM-dd HH,1H}&lt;br&gt;${yyyy/MM/dd HH,-1H}&lt;br&gt;${HH,-1H}");
        map.put("10分钟前",
                "${yyyyMMddHHmm,-10m}&lt;br&gt;${yyyy-MM-dd HH:mm,-10m}&lt;br&gt;${yyyy/MM/dd HH:mm,-10m}&lt;br&gt;${HH:mm,-10m}");
        map.put("季度第一天", "${yyyyMMdd,FQ}&lt;br&gt;${yyyy-MM-dd,FQ}&lt;br&gt;${yyyy/MM/dd,FQ}");
        map.put("季度最后一天", "${yyyyMMdd,EQ}&lt;br&gt;${yyyy-MM-dd,EQ}&lt;br&gt;${yyyy/MM/dd,EQ}");
        map.put("月第一天", "${yyyyMMdd,FM}&lt;br&gt;${yyyy-MM-dd,FM}&lt;br&gt;${yyyy/MM/dd,FM}");
        map.put("月最后一天", "${yyyyMMdd,EM}&lt;br&gt;${yyyy-MM-dd,EM}&lt;br&gt;${yyyy/MM/dd,EM}");
        map.put("周一", "${yyyyMMdd,FW}&lt;br&gt;${yyyy-MM-dd,FW}&lt;br&gt;${yyyy/MM/dd,FW}");
        map.put("周日", "${yyyyMMdd,EW}&lt;br&gt;${yyyy-MM-dd,EW}&lt;br&gt;${yyyy/MM/dd,EW}");
        String dateTime = "2015-08-10 14:40";
        System.out.println(dateTime);
        dateTime = dateTime.replace("-", "").replace(" ", "").replace(":", "");

        for (Entry&lt;String, String&gt; entry : map.entrySet()) {
            String detail = entry.getKey();
            String str = entry.getValue();

            System.out.println("&lt;tr&gt;");
            String rs = DateExpressionEngine.formatDateExpression(str, dateTime);
            System.out.println("&lt;td&gt;" + detail + "&lt;/td&gt;");
            System.out.println("&lt;td&gt;" + str + "&lt;/td&gt;");
            System.out.println("&lt;td&gt;" + rs + "&lt;/td&gt;");
            System.out.println("&lt;/tr&gt;");
        }
    }

    /**
     * &lt;pre&gt;
     * 将版本号的字符串转换为 DateTime 对象
     * @param dataVersionNo 20150101 2015010123 201501012359
     * @return 被解析之后的DateTime
     * &lt;/pre&gt;
     */
    private static DateTime parseForDataVersionNo(String dataVersionNo) {
        int size = dataVersionNo.length();
        String tempFormat = CONST_DATE_STRING;
        if (size == CONST_DATE_STRING.length()) {
            tempFormat = CONST_DATE_STRING;
        } else if (size == CONST_HOUR_STRING.length()) {
            tempFormat = CONST_HOUR_STRING;
        } else if (size == CONST_MINUTE_STRING.length()) {
            tempFormat = CONST_MINUTE_STRING;
        } else {
            throw new IllegalArgumentException(String.format("wrong dataVersionNo:%s", dataVersionNo));
        }
        DateTimeFormatter formatter = DateTimeFormat.forPattern(tempFormat);
        DateTime dateTime = DateTime.parse(dataVersionNo, formatter);
        return dateTime;
    }

    
    //private static final String REGEX = "(\\$\\{([^s].*?)\\})";
    private static final String REGEX = "(\\$\\{(.*?)\\})";
    private static final Pattern PATTERN = Pattern.compile(REGEX);
    private static final Pattern DATE_PATTERN = Pattern.compile("^\\d{8,}$");
    private static final String FIRST_STRING = "F";
    private static final String END_STRING = "E";
    private static final String YEAR_STRING = "y";
    private static final String QUARTR_STRING = "Q";
    private static final String MONTH_STRING = "M";
    private static final String WEEK_STRING = "w";
    private static final String DAY_STRING = "d";
    private static final String HOUR_STRING = "H";
    private static final String MINUTE_STRING = "m";
    private static final String OFFSET_REGEX = "^(-?\\d+?)?([y,Y,M,w,W,d,D,H,h,m])$";
    private static final Pattern OFFSET_PATTERN = Pattern.compile(OFFSET_REGEX);
    private static final String OFFSET_SPECIAL_REGEX = "^([F,f,E,e])([M,w,W,q,Q])$";
    private static final Pattern OFFSET_SPECIAL_PATTERN = Pattern.compile(OFFSET_SPECIAL_REGEX);
    private static final String CONST_DATE_STRING = "yyyyMMdd";
    private static final String CONST_HOUR_STRING = "yyyyMMddHH";
    private static final String CONST_MINUTE_STRING = "yyyyMMddHHmm";

}
</pre> 
 <p>&nbsp;</p> 
 <p>&nbsp;</p> 
 <pre name="code" class="java">/**
 * &lt;pre&gt;
 * Copyright CDC [2000-2015]
 * &lt;/pre&gt;
 */
package org.kanpiaoxue.commons.utils;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertTrue;
import static org.junit.Assert.fail;

import org.junit.Test;

import com.google.common.collect.Lists;

import java.util.List;

/**
 * &lt;pre&gt;
 * DateExpressionEngineTest.java
 * @author kanpiaoxue&lt;br&gt;
 * @version 1.0
 * Create Time 2015年6月4日 下午7:29:22&lt;br&gt;
 * Description : DateExpressionEngine测试类
 * &lt;/pre&gt;
 */
public class DateExpressionEngineTest {


    @Test
    public void testFormatDateExpression() {
        String needProcessString = null;
        String dateValue = "20150604";
        try {
            DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
            fail("error");
        } catch (Exception e) {
            assertTrue(true);
        }
        needProcessString = "${yyyyMMdd}";
        dateValue = null;
        try {
            DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
            fail("error");
        } catch (Exception e) {
            assertTrue(true);
        }
        needProcessString = "${yyyyMMdd}";
        dateValue = "2015060";
        try {
            DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
            fail("error");
        } catch (Exception e) {
            assertTrue(true);
        }
        needProcessString = "${yyyyMMdd,-1d,3w}";
        dateValue = "2015060";
        try {
            DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
            fail("error");
        } catch (Exception e) {
            assertTrue(true);
        }

        needProcessString = "${yyyyMMdd,-1d,3X}";
        dateValue = "2015060";
        try {
            DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
            fail("error");
        } catch (Exception e) {
            assertTrue(true);
        }
        needProcessString = "${yyyyMMdd,-1d}";
        dateValue = "20150600000000";
        try {
            DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
            fail("error");
        } catch (Exception e) {
            assertTrue(true);
        }
        needProcessString = "${yyyyMMdd}";
        dateValue = "20150604";
        String rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150604", rs);
        
        needProcessString = "${yyyy=MM=dd}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015=06=04", rs);
        
        needProcessString = "${yyyyMM}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("201506", rs);

        needProcessString = "${MMdd}";
        dateValue = "201506041945";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("0604", rs);
        
        needProcessString = "${MMddHH}";
        dateValue = "201506041945";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("060419", rs);
        
        needProcessString = "${ddHH}";
        dateValue = "201506041945";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("0419", rs);
        
        needProcessString = "${HH}";
        dateValue = "201506041945";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("19", rs);
        
        needProcessString = "${HHmm}";
        dateValue = "201506041945";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("1945", rs);
        
        needProcessString = "${HH:mm}";
        dateValue = "201506041945";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("19:45", rs);
        
        needProcessString = "${yyyy-MM-dd}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-04", rs);

        needProcessString = "${yyyyMMddHH}";
        dateValue = "2015060401";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015060401", rs);

        needProcessString = "${yyyy-MM-dd HH}";
        dateValue = "2015060401";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-04 01", rs);

        needProcessString = "${yyyyMMddHHmm}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("201506040101", rs);

        needProcessString = "${yyyy/MM/dd HH:mm}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015/06/04 01:01", rs);

        needProcessString = "${yyyyMMdd,-1y}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20140604", rs);

        needProcessString = "${yyyy-MM-dd,-1y}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2014-06-04", rs);

        needProcessString = "${yyyyMMdd,0y}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150604", rs);

        needProcessString = "${yyyy-MM-dd,0y}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-04", rs);

        needProcessString = "${yyyyMMdd,10y}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20250604", rs);

        needProcessString = "${yyyy/MM/dd,10y}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2025/06/04", rs);

        needProcessString = "${yyyyMMdd,10Y}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20250604", rs);

        needProcessString = "${yyyy-MM-dd,10Y}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2025-06-04", rs);

        needProcessString = "${yyyyMMdd,-2M}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150404", rs);

        needProcessString = "${yyyy/MM/dd,-2M}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015/04/04", rs);

        needProcessString = "${yyyyMMdd,2M}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150804", rs);

        needProcessString = "${yyyy-MM-dd,2M}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-08-04", rs);

        needProcessString = "${yyyyMMdd,1w}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150611", rs);

        needProcessString = "${yyyy-MM-dd,1w}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-11", rs);

        needProcessString = "${yyyyMMdd,-1w}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150528", rs);

        needProcessString = "${yyyy-MM-dd,-1w}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-05-28", rs);

        needProcessString = "${yyyyMMdd,-3d}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150601", rs);

        needProcessString = "${yyyy-MM-dd,-3d}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-01", rs);

        needProcessString = "${yyyyMMdd,0d}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150604", rs);

        needProcessString = "${yyyy-MM-dd,0d}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-04", rs);

        needProcessString = "${yyyyMMdd,11d}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150615", rs);

        needProcessString = "${yyyy-MM-dd,11d}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-15", rs);

        needProcessString = "${yyyyMMdd,24h}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150605", rs);

        needProcessString = "${yyyy-MM-dd,24h}";
        dateValue = "20150604";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-05", rs);

        needProcessString = "${yyyyMMddHHmm,24h}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("201506050101", rs);

        needProcessString = "${yyyy-MM-dd HH:mm,24h}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-05 01:01", rs);

        needProcessString = "${yyyyMMddHHmm,24m}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("201506040125", rs);

        needProcessString = "${yyyy-MM-dd HH:mm,24m}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-04 01:25", rs);

        needProcessString = "${yyyyMMddHHmm,-4m}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("201506040057", rs);

        needProcessString = "${yyyy-MM-dd     HH:mm,-4m}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-04     00:57", rs);

        needProcessString = "${yyyyMMddHHmm,m}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("201506040101", rs);

        needProcessString = "${yyyy-MM-ddHHmm,m}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-040101", rs);

        needProcessString = "hello";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("hello", rs);

        needProcessString = "hello";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("hello", rs);

        needProcessString = "${yyyyMMdd}hello${yyyyMMdd,11d}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150604hello20150615", rs);

        needProcessString = "${yyyy-MM/dd}hello${yyyy/MM-dd,11d}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06/04hello2015/06-15", rs);

        needProcessString = "${yyyyMMdd,fq}hello${yyyyMMdd,EQ}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150401hello20150630", rs);

        needProcessString = "${yyyy-MM-dd,fq}hello${yyyy/MM/dd,EQ}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-04-01hello2015/06/30", rs);

        needProcessString = "${yyyyMMdd,Fq}hello${yyyyMMdd,EQ}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150401hello20150630", rs);

        needProcessString = "${yyyy-MM-dd,Fq}hello${yyyyMMdd,EQ}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-04-01hello20150630", rs);

        needProcessString = "${yyyyMMdd,Fq}hello${yyyyMMdd,eQ}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150401hello20150630", rs);

        needProcessString = "${yyyy MM dd,Fq}hello${yyyyMMdd,eQ}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015 04 01hello20150630", rs);

        needProcessString = "${yyyy-MM-dd,Fq}hello${yyyy/MM/dd,eQ}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-04-01hello2015/06/30", rs);

        needProcessString = "${yyyyMMdd,FM}hello${yyyyMMdd,eM}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150601hello20150630", rs);

        needProcessString = "${yyyy-MM-dd,FM}hello${yyyyMMdd,eM}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-01hello20150630", rs);

        needProcessString = "${yyyyMMdd,Fw}hello${yyyyMMdd,eW}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("20150601hello20150607", rs);

        needProcessString = "${yyyy-MM-dd,Fw}hello${yyyyMMdd,eW}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06-01hello20150607", rs);
        
        needProcessString = "${yyyy-MM,Fw}hello${yyyyMM,eW}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("2015-06hello201506", rs);
        
        needProcessString = "${dd,Fw}hello${dd,eW}";
        dateValue = "201506040101";
        rs = DateExpressionEngine.formatDateExpression(needProcessString, dateValue);
        System.out.println(rs);
        assertEquals("01hello07", rs);

        List&lt;String&gt; cmds = Lists.newArrayList();
        cmds.add("cd /home/work/etl/cdc-etl-sme/${yyyyMMdd,-1y}/scripts &amp;&amp; sh +x run.sh "
                + "ods/${yyyyMMdd}/baike/baike_launch_cost_log ${yyyyMMdd,-1d} ${yyyyMMdd,-1y}"
                + " ${yyyyMMdd,-2d} ${yyyyMMddHHmm,-3H} ${yyyyMMdd,-1w} ${yyyyMMdd,10y} ${yyyyMMdd,8d}");
        cmds.add("cd /home/work/etl/cdc-etl-sme/${yyyy-MM-dd,-1y}/scripts &amp;&amp; sh +x run.sh "
                + "ods/${yyyy-MM-dd}/baike/baike_launch_cost_log ${yyyy-MM-dd,-1d} ${yyyy-MM-dd,-1y}"
                + " ${yyyy-MM-dd,-2d} ${yyyy-MM-dd HH:mm,-3H} ${yyyy/MM/dd,-1w} ${yyyy/MM/dd,10y} ${yyyy/MM/dd,8d}");

        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log ${yyyyMMddHH}");
        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log ${yyyy-MM-dd HH}");

        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log ${yyyyMMddHHmm}");
        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log ${yyyy-MM-dd HH:mm}");

        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log ${yyyyMMdd,-1y}");
        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log ${yyyy-MM-dd,-1y}");

        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log ${yyyyMMdd,-1M}");
        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log ${yyyy-MM-dd,-1M}");

        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log ${yyyyMMdd,1d}");
        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log ${yyyy/MM/dd,1d}");

        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts ${yyyyMMddHHmm,-1d} &amp;&amp; sh"
                + " +x run.sh ods/baike/baike_launch_cost_log ${yyyyMMddHH,1H}");
        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts ${yyyy-MM-dd HH:mm,-1d} &amp;&amp; sh"
                + " +x run.sh ods/baike/baike_launch_cost_log ${yyyy/MM/dd HH,1H}");

        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log ${yyyyMMddHHmm,10m}");
        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log ${yyyy-MM-dd HH:mm,10m}");

        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh" + " ods/baike/baike_launch_cost_log");

        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log.${HH}");
        
        cmds.add("cd /home/work/etl/cdc-etl-sme/scripts &amp;&amp; sh +x run.sh"
                + " ods/baike/baike_launch_cost_log.${HHmm}");

        List&lt;String&gt; dataVersionNoList = Lists.newArrayList("20150923","2015092319","201509231923");

        // String dataVersionNo = "201501010101";
       // String dataVersionNo = "20150101";

        for (String dataVersionNo : dataVersionNoList) {
            System.out.println("*****************************************");
            int i = 0;
            for (String cmd : cmds) {
                cmd = DateExpressionEngine.formatDateExpression(cmd, dataVersionNo);
                if (i % 2 == 0) {
                    System.out.println("===================");
                }
                System.out.println(cmd);
                i++;
            }
        }
    }

}
</pre> 
 <p>&nbsp;</p> 
 <p>&nbsp;</p> 
</div>