#Eclipse Tips & Tricks: Detail Formatter-Variables view的详情进行格式化
###发表时间：2017-09-06
###分类：eclipse,经验,非技术
###iteye原始地址：<a href="https://kanpiaoxue.iteye.com/admin/blogs/2392382" target="_blank">https://kanpiaoxue.iteye.com/admin/blogs/2392382</a>

---

<div class="iteye-blog-content-contain" style="font-size: 14px;"> 
 <p>今天使用 eclipse 进行 debug 处理，在 eclipse 的 debug 模式中跟踪变量。</p> 
 <p>发现这个变量在Variables view视图中的详情信息中只显示了这个变量 toString()的内容。由于这个类的toString()没有被复写而是继承了 Object 基类的toString()，打印的是 hashCode()的值，不是我想要的。我想让它的 toString()被格式化为 JSON 结构并且是被格式化之后的 JSON结构，方便人的阅读。虽然我可以去改写这个类的toString()，但是我不想这么做，而是想利用 eclipse 的功能来实现。我去 Google 找了找，还真找到了解决方案。</p> 
 <p>参考地址：<a href="http://www.robertwloch.net/2012/01/eclipse-tips-tricks-detail-formatter/">http://www.robertwloch.net/2012/01/eclipse-tips-tricks-detail-formatter/</a></p> 
 <p>它里面就是使用了eclipse 下面 debug 的 Detail Formatters 的功能。详情请参考上面的地址。</p> 
 <p><span style="color: #ff0000; background-color: #ffff00;"><strong>设置的地方1：</strong> </span>Preference -&gt; Java - Debug -&gt; Detail Formatters 。在这里进行设置。</p> 
 <p><span style="color: #ff0000; background-color: #ffff00;"><strong>设置的地方2：</strong></span>在&nbsp;Variables view 的视图中，选择里面一个变量，点击鼠标右键会出现右键菜单，里面有一项菜单就是”New Detail Formatter...“的。选择这个功能，在这里设置。</p> 
 <p>在“Types with detail formatter" 的这里选择你要覆盖 toString() 方法的 interface 或者 class 都行。跳出的对话框中会让你在”Detail formatter code snippet“里面输入 format 的格式化代码。</p> 
 <p>我的代码如下：</p> 
 <pre name="code" class="java">return new com.google.gson.GsonBuilder().setPrettyPrinting().create().toJson(this);</pre> 
 <p>&nbsp;使用 Gson 对代码进行 json 化，使用 GsonBuilder 的<span style="background-color: #fafafa; font-family: monospace;">setPrettyPrinting()方法使得 json 被格式化为人方便阅读的格式。</span></p> 
 <p><span style="background-color: #fafafa; font-family: monospace;">然后就可以 debug 去了，你会发现在 debug 模式的</span><span style="font-family: monospace;">Variables view窗口的 detail 里面你关注的类已经被覆盖了 toString() 方法显示出你格式化之后的内容。这个是 eclipse 非常强大的功能。</span></p> 
 <p><span style="font-family: monospace;">下面是参考网址的内容：</span></p> 
 <p>&nbsp;</p> 
 <div class="post-headline" style="font-family: verdana, arial, sans-serif; font-size: 13px;"> 
  <h1 style="margin-bottom: 0px; font-size: 1.7em;">Eclipse Tips &amp; Tricks: Detail Formatter</h1> 
 </div> 
 <div class="post-byline" style="margin: 5px 0px 10px; color: #999999; letter-spacing: 1px; font-size: 11px; font-family: verdana, arial, sans-serif;">
  BY ROBERT, ON JANUARY 28TH, 2012, 51,751 VIEWS
 </div> 
 <div class="post-bodycopy clearfix" style="min-width: 0px; font-family: verdana, arial, sans-serif; font-size: 13px;"> 
  <h4 style="margin-top: 10px; margin-bottom: 10px;">1. Your Situation</h4> 
  <p style="margin-top: 1em; margin-bottom: 1em;">You find yourself debugging a Java app with Eclipse and you’re stepping through the code in the&nbsp;<em>Debug</em>&nbsp;perspective. You have the&nbsp;<em>Variables</em>&nbsp;view open and for most of the selected types you can see a reasonable&nbsp;<tt>toString()</tt>&nbsp;output below the variables list.</p> 
  <p style="margin-top: 1em; margin-bottom: 1em;">However, many types don’t have a type specific implementation of&nbsp;<tt>toString()</tt>. E.g., consider an array of objects. There’s no&nbsp;<tt>toString()</tt>&nbsp;on arrays. That’s why the variables view prints you some meaningless default text with a hashcode for such variables.</p> 
  <p style="margin-top: 1em; margin-bottom: 1em;">But did you know that you can change that by defining a custom&nbsp;<tt>toString()</tt>&nbsp;implementation that’s used by the variables view at runtime? Let me introduce you to the concept of&nbsp;<strong><em>Detail Formatters</em></strong>&nbsp;and learn about the&nbsp;<em>Display</em>&nbsp;view along the way, too.</p> 
  <h4 style="margin-top: 10px; margin-bottom: 10px;">2. Preparing a custom type evaluation</h4> 
  <p style="margin-top: 1em; margin-bottom: 1em;">Lets start at a breakpoint in some arbitrary code as shown in the following screenshot.&nbsp;<img style="border-width: 1px; border-style: solid; border-color: #dddddd; padding: 5px; background-color: #f3f3f3; border-radius: 3px;" src="http://www.robertwloch.net/wp-content/gallery/common-icons/1.png" alt="" width="12px" height="12px" align="middle">&nbsp;The debugger stopped within a for-loop that iterates over a collection of&nbsp;<tt>CellBindDesc</tt>&nbsp;elements.&nbsp;<img style="border-width: 1px; border-style: solid; border-color: #dddddd; padding: 5px; background-color: #f3f3f3; border-radius: 3px;" src="http://www.robertwloch.net/wp-content/gallery/common-icons/2.png" alt="" width="12px" height="12px" align="middle">&nbsp;In the&nbsp;<em>Variables</em>&nbsp;view the variable&nbsp;<tt>desc</tt>&nbsp;is selected to see what’s inside. Unfortunately, the class&nbsp;<tt>CellBindDesc</tt>&nbsp;didn’t override&nbsp;<tt>toString()</tt>. That’s why the default gibberish is printed below the variables list&nbsp;<img style="border-width: 1px; border-style: solid; border-color: #dddddd; padding: 5px; background-color: #f3f3f3; border-radius: 3px;" src="http://www.robertwloch.net/wp-content/gallery/common-icons/3.png" alt="" width="12px" height="12px" align="middle">.</p> 
  <p style="margin-top: 1em; margin-bottom: 1em;"><a style="color: #365da0; font-weight: bold;" title="Prepare a code snippet to create a String representation for a type." href="http://www.robertwloch.net/wp-content/uploads/2012/01/01-prepare-evaluation.png"><img class="aligncenter size-large wp-image-186" style="border-width: 1px; border-style: solid; border-color: #dddddd; display: block; margin: 10px auto; padding: 5px; background-color: #f3f3f3; border-radius: 3px;" title="Prepare a code snippet to create a String representation for a type." src="http://www.robertwloch.net/wp-content/uploads/2012/01/01-prepare-evaluation-1024x640.png" alt="Prepare a code snippet to create a String representation for a type." width="640" height="400"></a></p> 
  <p style="margin-top: 1em; margin-bottom: 1em;">You do not need to know all the details about the&nbsp;<tt>CellBindDesc</tt>. It’s enough to know that it’s a description of mapping a model element’s field to an uiElement, e.g. a&nbsp;<tt>String</tt>&nbsp;property to a&nbsp;<tt>Text</tt>&nbsp;field.<br>To find a specific field of a model element the&nbsp;<tt>CellBindDesc</tt>&nbsp;holds an array of model element&nbsp;<tt>properties</tt>&nbsp;<img style="border-width: 1px; border-style: solid; border-color: #dddddd; padding: 5px; background-color: #f3f3f3; border-radius: 3px;" src="http://www.robertwloch.net/wp-content/gallery/common-icons/4.png" alt="" width="12px" height="12px" align="middle">&nbsp;that’s similar to a tree path. The first element is a reference to a property of the model root element that’s stored in the&nbsp;<tt>model</tt>&nbsp;field of&nbsp;<tt>CellBindDesc</tt>. The other elements are references to properties of the model tree.</p> 
  <p style="margin-top: 1em; margin-bottom: 1em;">So, what I actually want to see below the variables list is not the gibberish, but at least the path to the model property and a hint to which&nbsp;<tt>uiElement</tt>&nbsp;it is bound. Sounds like some&nbsp;<tt>StringBuilder</tt>&nbsp;code, right? To create and test this code on the fly you should open the&nbsp;<em>Display</em>&nbsp;view&nbsp;<img style="border-width: 1px; border-style: solid; border-color: #dddddd; padding: 5px; background-color: #f3f3f3; border-radius: 3px;" src="http://www.robertwloch.net/wp-content/gallery/common-icons/5.png" alt="" width="12px" height="12px" align="middle">. Imagine this view as being a container of code statements that are inlined at the position of the current debug step. In case of the screenshot above that would be line 170.<br>But the code is not really inlined. Instead you can use the&nbsp;<em>Inspect</em>&nbsp;command to execute the selected statements at that debug step. You can run that command with [Ctrl]+[Shift]+[I].</p> 
  <p style="margin-top: 1em; margin-bottom: 1em;">As you can see in the screenshot all lines are selected and the last statement even is a&nbsp;<tt>return</tt>&nbsp;statement that concatenates stuff to a&nbsp;<tt>String</tt>. Running [Ctrl]+[Shift]+[I] on that selection will show the familiar&nbsp;<em>Inspect</em>&nbsp;popup containing a&nbsp;<tt>String</tt>&nbsp;node with the return value if you did it right.</p> 
  <p style="margin-top: 1em; margin-bottom: 1em;">As you can see in this example, the&nbsp;<em>Display</em>&nbsp;view is very powerful. It’s so important to me, that I always open it when debugging. By the way, code completion does work there, too.</p> 
  <h4 style="margin-top: 10px; margin-bottom: 10px;">3. Edit the Detail Formatter</h4> 
  <p style="margin-top: 1em; margin-bottom: 1em;">Now, with the snippet being tested in the&nbsp;<em>Display</em>&nbsp;view and the result being what one would actually like to see at&nbsp;<img style="border-width: 1px; border-style: solid; border-color: #dddddd; padding: 5px; background-color: #f3f3f3; border-radius: 3px;" src="http://www.robertwloch.net/wp-content/gallery/common-icons/3.png" alt="" width="12px" height="12px" align="middle">&nbsp;it’s time to configure the&nbsp;<em>Detail Formatter</em>. Open the context menu on the variable for which you wish to configure a&nbsp;<em>Detail Formatter</em>&nbsp;and select the&nbsp;<em>Edit Detail Formatter…</em>entry&nbsp;<img style="border-width: 1px; border-style: solid; border-color: #dddddd; padding: 5px; background-color: #f3f3f3; border-radius: 3px;" src="http://www.robertwloch.net/wp-content/gallery/common-icons/6.png" alt="" width="12px" height="12px" align="middle">.</p> 
  <p style="margin-top: 1em; margin-bottom: 1em;"><img class="aligncenter size-full wp-image-187" style="border-width: 1px; border-style: solid; border-color: #dddddd; display: block; margin: 10px auto; padding: 5px; background-color: #f3f3f3; border-radius: 3px; max-width: 96%; width: auto; height: auto;" title="Provide the body for a toString() method." src="http://www.robertwloch.net/wp-content/uploads/2012/01/02-define_detail_formatter.png" alt="Provide the body for a toString() method." width="561" height="425"></p> 
  <p style="margin-top: 1em; margin-bottom: 1em;">In the&nbsp;<em>Edit Detail Formatter</em>&nbsp;dialog paste the snippet from the&nbsp;<em>Display</em>&nbsp;view and make sure the&nbsp;<em>Detail Formatter</em>&nbsp;is enabled.<br>After closing the dialog you should see the detail formatted output of your selected variable. In case of my example I’m now able to see the type, the model path and the ui element of each&nbsp;<tt>CellBindDesc</tt>&nbsp;directly below the variables list.</p> 
  <p style="margin-top: 1em; margin-bottom: 1em;">As the&nbsp;<em>Detail Formatter</em>&nbsp;is used for every instance of the type on which it is defined I am now able to step through the list via [F8]. No more need to check each property of the variable&nbsp;<tt>desc</tt>&nbsp;until I know all the values I need to tell if something is wrong. Ain’t that a great time safer? I bet it is!</p> 
  <p style="margin-top: 1em; margin-bottom: 1em;"><a style="color: #365da0; font-weight: bold;" title="The snippet of the Detail Formatter is evaluated and the resulting String is shown below the list of variables in the Variables view." href="http://www.robertwloch.net/wp-content/uploads/2012/01/03-detail-formatter_in_use.png"><img class="aligncenter size-large wp-image-188" style="border-width: 1px; border-style: solid; border-color: #dddddd; display: block; margin: 10px auto; padding: 5px; background-color: #f3f3f3; border-radius: 3px;" title="The snippet of the Detail Formatter is evaluated and the resulting String is shown below the list of variables in the Variables view." src="http://www.robertwloch.net/wp-content/uploads/2012/01/03-detail-formatter_in_use-1024x640.png" alt="The snippet of the Detail Formatter is evaluated and the resulting String is shown below the list of variables in the Variables view." width="640" height="400"></a></p> 
  <h4 style="margin-top: 10px; margin-bottom: 10px;">4. Happy Debugging</h4> 
  <p style="margin-top: 1em; margin-bottom: 1em;">Things you should have learned:</p> 
  <ol style="margin-top: 10px; margin-bottom: 10px;"> 
   <li>Always open the&nbsp;<em>Display</em>&nbsp;view when you’re in the&nbsp;<em>Debug</em>&nbsp;perspective and make use of it. You can even collect several statements there and select only the one(s) you need for inspection depending on your debug context.</li> 
   <li>Write&nbsp;<em>Detail Formatters</em>&nbsp;for arrays and complex types to show more details in the&nbsp;<em>Variables</em>&nbsp;view.&nbsp;<em>Detail Formatters</em>&nbsp;do even override&nbsp;<tt>toString()</tt>&nbsp;implementations if there should be one!</li> 
  </ol> 
  <p style="margin-top: 1em; margin-bottom: 1em;">Happy debugging!</p> 
 </div> 
 <p>&nbsp;</p> 
 <p>&nbsp;</p> 
</div>