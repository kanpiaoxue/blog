#调度系统设计要素
###发表时间：2015-10-16
###分类：非技术,经验
###iteye原始地址：<a href="https://kanpiaoxue.iteye.com/admin/blogs/2249636" target="_blank">https://kanpiaoxue.iteye.com/admin/blogs/2249636</a>

---

<div class="iteye-blog-content-contain" style="font-size: 14px;"> 
 <p>&nbsp;</p> 
 <p>&nbsp;</p> 
 <p>调度系统时间粒度：分钟、小时、日、周、月、季度、年</p> 
 <p>依赖关系上下类型：时间粒度上大下小、<span style="line-height: 1.5;">时间粒度相等、</span><span style="line-height: 1.5;">时间粒度上小下大</span></p> 
 <p><span style="line-height: 1.5;">依赖关系分类：普通依赖（上下游）、截止依赖（累积性的任务，需要累计到某一天。周截止任务，会依赖于周一一直到现在的上游任务的数据）、自依赖（依赖于自身任务前面运行的结果）</span></p> 
 <p><span style="line-height: 1.5;">依赖关系的属性：偏移量、步长、左右补偿。</span></p> 
 <p>&nbsp;</p> 
 <p><span style="line-height: 1.5;">时序性：时序性很关键，尤其是对于累积性的任务，自身依赖的任务。一定时序性错乱，任务产生的数据结果就是乱序的，没有价值和意义的数据。</span></p> 
 <p>&nbsp;</p> 
 <p>名词：任务、任务数据版本、任务运行实例</p> 
 <p>&nbsp;</p> 
 <p>---------------------------</p> 
 <p>资源调度器：</p> 
 <p>1、管理集群下每一台机器的负载信息的时候，如:CPU和内存的使用量的时候，需要为集群下面每台机器设置不同的阈值。因为每台机器的CPU和内存是异构的，需要定制化。</p> 
 <p>如：专用的机器的内存和CPU要预留20%的CPU和30%的内存供操作系统和其他进程使用。</p> 
 <p>和其他进程共享的机器，要预留更多的cpu和内存，共其他的进程使用。</p> 
 <p>-- 严谨为资源调度器配置一个统一的负载阈值，否则会造成有的机器cpu和内存被打满的情况出现</p> 
 <p>2、资源隔离问题</p> 
 <p>各个团队的资源一定要隔离。比如资源调度器会使用zk存储运行的记录信息，存储的信息往往分团队存放。如果zk的一个团队节点出现问题，会影响整个zk的使用，使得系统宕机或者工作不正常。</p> 
 <p>要解决这一的问题，需要为每个团队创建zk链接，这样一来，即使一个zk异常了，其他的团队业务不受影响。</p> 
 <p>-- 上面zk的根据团队进行隔离的问题，只是一个典型的例子。其他的关于团队的资源，都需要做到隔离，防止彼此交织影响。2015/12/07，我们线上系统的资源调度器就出现了一个多团队共享zk，其中一个团队zk出现问题，影响了整个系统的情况。</p> 
 <p>（这个问题是zk的单个node下面写入的data超过4M，读取出现问题，从而引起zk的session超时，系统不可用）</p> 
 <p>&nbsp;</p> 
 <p>&nbsp;3、web页面的功能设计</p> 
 <p>在运维页面，针对每个任务的操作功能，一定要设置对应的批量处理功能。如：杀死，批量杀死；修复任务，批量修复任务，等等。</p> 
 <p>当出现几千个任务需要处理的时候，批量操作额外重要，避免后台使用sql操作引起的其他异常。（备注:SQL处理后台数据非常危险，要禁止这样的操作）</p> 
 <p>&nbsp;</p> 
 <p>&nbsp;</p> 
 <p>&nbsp;</p> 
 <p>&nbsp;</p> 
 <p>&nbsp;</p> 
 <p>&nbsp;</p> 
</div>