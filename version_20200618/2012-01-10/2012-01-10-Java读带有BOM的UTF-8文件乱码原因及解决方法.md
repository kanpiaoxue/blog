#Java读带有BOM的UTF-8文件乱码原因及解决方法
###发表时间：2012-01-10
###分类：java
###iteye原始地址：<a href="https://kanpiaoxue.iteye.com/admin/blogs/1339792" target="_blank">https://kanpiaoxue.iteye.com/admin/blogs/1339792</a>

---

<p> </p>
<p style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left; padding: 0px;">最近在处理文件时发现了同样类型的文件使用的编码可能是不同的。所以想将文件的格式统一一下(因为UTF-8的通用性，决定往UTF-8统一)，遇见的第一个问题是：如何查看现有文件的编码方式。<br><br>上网找了一下，找到几篇比较好文章，这里就不转载啦把链接搞过来。<br><a style="color: #108ac6;" href="http://blog.csdn.net/fancyaphy/archive/2006/03/09/619972.aspx" target="_blank">文件编码问题集锦</a>&nbsp;<br><a style="color: #108ac6;" href="http://www.iteye.com/topic/31860" target="_blank">字符串编码(charset,encoding，decoding)问题原理</a>&nbsp;<br><a style="color: #108ac6;" href="http://www.iteye.com/topic/311583" target="_blank">Java编码浅析</a>&nbsp;<br><a style="color: #108ac6;" href="http://www.iteye.com/topic/108540" target="_blank">判定文件编码或文本流编码的方法</a>&nbsp;<br>上面的几篇文章可以看成认识编码问题的“从入门到精通”<br><br>如果你看完了上面的文章，一定了解到了，在java中，class文件采用utf8的编码方式，JVM运行时采用utf16。Java的字符串是永远都是unicode的，采用的是UTF-16的编码方式。<br><br>想测试一下，java对UTF-8文件的读写的能力，结果发现了一个很郁闷的问题，如果通过java写的UTF-8文件，使用Java可以正确的读，但是如果用记事本将相同的内容使用UTF-8格式保存，则在使用程序读取是会从文件中多读出一个不可见字符。<br>测试代码如下：</p>
<div class="dp-highlighter" style="font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; width: 679px; margin-left: 9px; line-height: 25px; text-align: left; padding: 1px;"> 
 <div class="bar"> 
  <div class="tools" style="font-weight: bold; padding: 3px; margin: 0px;">
   Java代码&nbsp;
   <embed quality="high" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" width="14" height="15" src="http://daimojingdeyu.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf" wmode="transparent">&nbsp;
   <a style="color: #108ac6;" title="收藏这段代码" href="http://daimojingdeyu.iteye.com/blog/397661"><img class="star" style="border-color: initial;" src="http://daimojingdeyu.iteye.com/images/icon_star.png" alt="收藏代码"></a> 
  </div> 
 </div> 
 <ol class="dp-j" style="font-size: 1em; line-height: 1.4em; margin-top: 0px; margin-right: 0px; margin-bottom: 1px; margin-left: 0px; padding-top: 2px; padding-right: 0px; padding-bottom: 2px; padding-left: 0px; color: #2b91af; border: 1px solid #d1d7dc;"> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;"> <span class="keyword" style="color: #7f0055; font-weight: bold;">import</span>&nbsp;java.io.BufferedReader;&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;"> <span class="keyword" style="color: #7f0055; font-weight: bold;">import</span>&nbsp;java.io.File;&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;"> <span class="keyword" style="color: #7f0055; font-weight: bold;">import</span>&nbsp;java.io.FileInputStream;&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;"> <span class="keyword" style="color: #7f0055; font-weight: bold;">import</span>&nbsp;java.io.IOException;&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;"> <span class="keyword" style="color: #7f0055; font-weight: bold;">import</span>&nbsp;java.io.InputStreamReader;&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;"> <span class="keyword" style="color: #7f0055; font-weight: bold;">public</span>&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">class</span>&nbsp;UTF8Test&nbsp;{&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">public</span>&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">static</span>&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">void</span>&nbsp;main(String[]&nbsp;args)&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">throws</span>&nbsp;IOException&nbsp;{&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File&nbsp;f&nbsp;&nbsp;=&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">new</span>&nbsp;File(<span class="string" style="color: blue;">"./utf.txt"</span>);&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileInputStream&nbsp;in&nbsp;=&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">new</span>&nbsp;FileInputStream(f);&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #008200;">//&nbsp;指定读取文件时以UTF-8的格式读取</span>&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BufferedReader&nbsp;br&nbsp;=&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">new</span>&nbsp;BufferedReader(<span class="keyword" style="color: #7f0055; font-weight: bold;">new</span>&nbsp;InputStreamReader(in,&nbsp;<span class="string" style="color: blue;">"UTF-8"</span>));&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;line&nbsp;=&nbsp;br.readLine();&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">while</span>(line&nbsp;!=&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">null</span>)&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(line);&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;br.readLine();&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">}&nbsp;&nbsp;</li> 
 </ol> 
</div>
<p style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left; padding: 0px;"><br><br>utf.txt通过记事本创建，另存时使用指定utf-8编码，其内容为：</p>
<div class="quote_title" style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left;">
 引用
</div>
<div class="quote_div" style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left;"> 
 <br>This is the first line.
 <br>This is second line.
 <br> 
</div>
<p style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left; padding: 0px;"><br><br>正常的测试结果应该是直接输出utf.txt的文本内容。可是实际上却输出了下面的内容：</p>
<div class="quote_title" style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left;">
 引用
</div>
<div class="quote_div" style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left;"> 
 <br>?This is the first line.
 <br>This is second line.
 <br> 
</div>
<p style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left; padding: 0px;"><br>第一行多出了一个问号。<br>通过上面的几篇文章应该可以想到是Java读取BOM（Byte Order　Mark）的问题，在使用UTF-8时，可以在文件的开始使用3个字节的"EF BB BF"来标识文件使用了UTF-8的编码，当然也可以不用这个3个字节。<br>上面的问题应该就是因为对开头3个字节的读取导致的。开始不太相信这个是JDK的Bug，后来在多次试验后，问题依然存在，就又狗狗了一下，果然找到一个如下的Bug:<br><a style="color: #108ac6;" href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058" target="_blank">Bug ID:4508058</a>&nbsp;<br>不过在我关掉的一些页面中记得有篇文件说这个bug只在jdk1.5及之前的版本才有，说是1.6已经解决了，从目前来看1.6只是解决了读取带有BOM文件失败的问题，还是不能区别处理有BOM和无BOM的UTF-8编码的文件，从Bug ID:4508058里的描述可以看出，这个问题将作为一个不会修改的问题关闭，对于BOM编码的识别将由应用程序自己来处理，原因可从另处一个bug处查看到，因为Unicode对于BOM的编码的规定可能发生变化。也就是说对于一个UTF-8的文件，应用程序需要知道这个文件有没有写BOM，然后自己决定处理BOM的方式。<br><br>在上面的while循环中可加入下面的代码，测试一下读出内容：</p>
<div class="dp-highlighter" style="font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; width: 679px; margin-left: 9px; line-height: 25px; text-align: left; padding: 1px;"> 
 <div class="bar"> 
  <div class="tools" style="font-weight: bold; padding: 3px; margin: 0px;">
   Java代码&nbsp;
   <embed quality="high" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" width="14" height="15" src="http://daimojingdeyu.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf" wmode="transparent">&nbsp;
   <a style="color: #108ac6;" title="收藏这段代码" href="http://daimojingdeyu.iteye.com/blog/397661"><img class="star" style="border-color: initial;" src="http://daimojingdeyu.iteye.com/images/icon_star.png" alt="收藏代码"></a> 
  </div> 
 </div> 
 <ol class="dp-j" style="font-size: 1em; line-height: 1.4em; margin-top: 0px; margin-right: 0px; margin-bottom: 1px; margin-left: 0px; padding-top: 2px; padding-right: 0px; padding-bottom: 2px; padding-left: 0px; color: #2b91af; border: 1px solid #d1d7dc;"> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;"> <span class="keyword" style="color: #7f0055; font-weight: bold;">byte</span>[]&nbsp;allbytes&nbsp;=&nbsp;line.getBytes(<span class="string" style="color: blue;">"UTF-8"</span>);&nbsp;&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">for</span>&nbsp;(<span class="keyword" style="color: #7f0055; font-weight: bold;">int</span>&nbsp;i=<span class="number" style="color: #c00000;">0</span>;&nbsp;i&nbsp;&lt;&nbsp;allbytes.length;&nbsp;i++)&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">int</span>&nbsp;tmp&nbsp;=&nbsp;allbytes[i];&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;hexString&nbsp;=&nbsp;Integer.toHexString(tmp);&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #008200;">//&nbsp;1个byte变成16进制的，只需要2位就可以表示了，取后面两位，去掉前面的符号填充</span>&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hexString&nbsp;=&nbsp;hexString.substring(hexString.length()&nbsp;-<span class="number" style="color: #c00000;">2</span>);&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.print(hexString.toUpperCase());&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.print(<span class="string" style="color: blue;">"&nbsp;"</span>);&nbsp;&nbsp;</li> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li> 
 </ol> 
</div>
<p style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left; padding: 0px;"><br><br>输出结果如下：</p>
<div class="quote_title" style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left;">
 引用
</div>
<div class="quote_div" style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left;"> 
 <br>
 <span style="color: red;">EF BB BF</span>&nbsp;54 68 69 73 20 69 73 20 74 68 65 20 66 69 72 73 74 20 6C 69 6E 65 2E&nbsp;
 <br>?This is the first line.
 <br>54 68 69 73 20 69 73 20 73 65 63 6F 6E 64 20 6C 69 6E 65 2E&nbsp;
 <br>This is second line.
 <br>
 <br> 
</div>
<p style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left; padding: 0px;"><br>红色部分的"EF BB BF"刚好是UTF-8文件的BOM编码，可以看出Java在读文件时没能正确处理UTF-8文件的BOM编码，将前3个字节当作文本内容来处理了。<br><br>使用链接中提供的代码可以解决碰到的乱码问题：<br><a style="color: #108ac6;" href="http://koti.mbnet.fi/akini/java/unicodereader/" target="_blank">http://koti.mbnet.fi/akini/java/unicodereader/</a>&nbsp;<br><br>修改测试代码中的输入流后：</p>
<div class="dp-highlighter" style="font-family: Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace; width: 679px; margin-left: 9px; line-height: 25px; text-align: left; padding: 1px;"> 
 <div class="bar"> 
  <div class="tools" style="font-weight: bold; padding: 3px; margin: 0px;">
   Java代码&nbsp;
   <embed quality="high" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" width="14" height="15" src="http://daimojingdeyu.iteye.com/javascripts/syntaxhighlighter/clipboard_new.swf" wmode="transparent">&nbsp;
   <a style="color: #108ac6;" title="收藏这段代码" href="http://daimojingdeyu.iteye.com/blog/397661"><img class="star" style="border-color: initial;" src="http://daimojingdeyu.iteye.com/images/icon_star.png" alt="收藏代码"></a> 
  </div> 
 </div> 
 <ol class="dp-j" style="font-size: 1em; line-height: 1.4em; margin-top: 0px; margin-right: 0px; margin-bottom: 1px; margin-left: 0px; padding-top: 2px; padding-right: 0px; padding-bottom: 2px; padding-left: 0px; color: #2b91af; border: 1px solid #d1d7dc;"> 
  <li style="font-size: 1em; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 38px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 10px; border-left-width: 1px; border-left-style: solid; border-left-color: #d1d7dc; background-color: #fafafa; line-height: 18px;">BufferedReader&nbsp;br&nbsp;=&nbsp;<span class="keyword" style="color: #7f0055; font-weight: bold;">new</span>&nbsp;BufferedReader(<span class="keyword" style="color: #7f0055; font-weight: bold;">new</span>&nbsp;UnicodeReader(in,&nbsp;Charset.defaultCharset().name()));&nbsp;&nbsp;</li> 
 </ol> 
</div>
<p style="font-family: Helvetica, Tahoma, Arial, sans-serif; font-size: 14px; line-height: 25px; text-align: left; padding: 0px;"><br>执行，可以看到正确的结果。</p>
<p>&nbsp;</p>
<p>引自：&nbsp;<a href="http://daimojingdeyu.iteye.com/blog/397661">http://daimojingdeyu.iteye.com/blog/397661</a></p>