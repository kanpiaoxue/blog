#Linux自启动设置详解
###发表时间：2012-02-02
###分类：Linux
###iteye原始地址：<a href="https://kanpiaoxue.iteye.com/admin/blogs/1390893" target="_blank">https://kanpiaoxue.iteye.com/admin/blogs/1390893</a>

---

<p><strong style="">前言<br></strong><span style="">linux有自己一套完整的启动体系，抓住了linux启动的脉络，linux的启动过程将不再神秘。&nbsp;</span><br style=""><span style="">阅读之前建议先看一下附图。&nbsp;</span><br style=""><span style="">本文中假设inittab中设置的init tree为：&nbsp;</span><br style=""><span style="">/etc/rc.d/rc0.d&nbsp;</span><br style=""><span style="">/etc/rc.d/rc1.d&nbsp;</span><br style=""><span style="">/etc/rc.d/rc2.d&nbsp;</span><br style=""><span style="">/etc/rc.d/rc3.d&nbsp;</span><br style=""><span style="">/etc/rc.d/rc4.d&nbsp;</span><br style=""><span style="">/etc/rc.d/rc5.d&nbsp;</span><br style=""><span style="">/etc/rc.d/rc6.d&nbsp;</span><br style=""><span style="">/etc/rc.d/init.d&nbsp;</span><br style=""><br style=""><strong style="">目录</strong><span style="">&nbsp;</span><br style=""><span style="">1. 关于linux的启动&nbsp;</span><br style=""><span style="">2. 关于rc.d&nbsp;</span><br style=""><span style="">3. 启动脚本示例&nbsp;</span><br style=""><span style="">4. 关于rc.local&nbsp;</span><br style=""><span style="">5. 关于bash启动脚本&nbsp;</span><br style=""><span style="">6. 关于开机程序的自动启动&nbsp;</span><br style=""><br style=""><span style="">1. 关于linux的启动&nbsp;</span><br style=""><span style="">init是所有进程的顶层</span><br style=""><span style="">init读取/etc/inittab，执行rc.sysinit脚本&nbsp;</span><br style=""><span style="">(注意文件名是不一定的,有些unix甚至会将语句直接写在inittab中)&nbsp;</span><br style=""><span style="">rc.sysinit脚本作了很多工作:&nbsp;</span><br style=""><br style=""><span style="">init $PATH&nbsp;</span><br style=""><span style="">config network&nbsp;</span><br style=""><span style="">start swap function&nbsp;</span><br style=""><span style="">set hostname&nbsp;</span><br style=""><span style="">check root file system, repair if needed&nbsp;</span><br style=""><span style="">check root space&nbsp;</span><br style=""><span style="">....&nbsp;</span><br style=""><br style=""><span style="">rc.sysinit根据inittab执行rc?.d脚本&nbsp;</span><br style=""><span style="">linux是多用户系统，getty是多用户与单用户的分水岭&nbsp;</span><br style=""><span style="">在getty之前运行的是系统脚本&nbsp;</span><br style=""><br style=""><span style="">2. 关于rc.d&nbsp;</span><br style=""><span style="">所有启动脚本放置在 /etc/rc.d/init.d下&nbsp;</span><br style=""><span style="">rc?.d中放置的是init.d中脚本的链接，命名格式是：&nbsp;</span><br style=""><span style="">S{number}{name}&nbsp;</span><br style=""><span style="">K{number}{name}&nbsp;</span><br style=""><span style="">S开始的文件向脚本传递start参数&nbsp;</span><br style=""><span style="">K开始的文件向脚本传递stop参数&nbsp;</span><br style=""><span style="">number决定执行的顺序&nbsp;</span><br style=""><br style=""><span style="">3. 启动脚本示例&nbsp;</span><br style=""><br style=""><span style="">这是一个用来启动httpd的 /etc/rc.d/init.d/apache 脚本：&nbsp;</span><br style=""><br style=""><span style="">代码:&nbsp;</span><br style=""><span style="">#!/bin/bash&nbsp;</span><br style=""><span style="">......&nbsp;</span><br style=""><br style=""><span style="">可以看出他接受start,stop,restart,status参数&nbsp;</span><br style=""><br style=""><span style="">然后可以这样建立rc?.d的链接：&nbsp;</span><br style=""><br style=""><span style="">代码:&nbsp;</span><br style=""><span style="">cd /etc/rc.d/init.d &amp;&amp;&nbsp;</span><br style=""><span style="">ln -sf ../init.d/apache ../rc0.d/K28apache &amp;&amp;&nbsp;</span><br style=""><span style="">ln -sf ../init.d/apache ../rc1.d/K28apache &amp;&amp;&nbsp;</span><br style=""><span style="">ln -sf ../init.d/apache ../rc2.d/K28apache &amp;&amp;&nbsp;</span><br style=""><span style="">ln -sf ../init.d/apache ../rc3.d/S32apache &amp;&amp;&nbsp;</span><br style=""><span style="">ln -sf ../init.d/apache ../rc4.d/S32apache &amp;&amp;&nbsp;</span><br style=""><span style="">ln -sf ../init.d/apache ../rc5.d/S32apache &amp;&amp;&nbsp;</span><br style=""><span style="">ln -sf ../init.d/apache ../rc6.d/K28apache&nbsp;</span><br style=""><br style=""><span style="">4. 关于rc.local&nbsp;</span><br style=""><br style=""><span style="">经常使用的 rc.local 则完全是习惯问题，不是标准。&nbsp;</span><br style=""><span style="">各个发行版有不同的实现方法，可以这样实现：&nbsp;</span><br style=""><br style=""><span style="">代码:&nbsp;</span><br style=""><span style="">touch /etc/rc.d/rc.local&nbsp;</span><br style=""><span style="">chmod +x /etc/rc.d/rc.local&nbsp;</span><br style=""><span style="">ln -sf /etc/rc.d/rc.local /etc/rc.d/rc1.d/S999rc.local &amp;&amp;&nbsp;</span><br style=""><span style="">ln -sf /etc/rc.d/rc.local /etc/rc.d/rc2.d/S999rc.local &amp;&amp;&nbsp;</span><br style=""><span style="">ln -sf /etc/rc.d/rc.local /etc/rc.d/rc3.d/S999rc.local &amp;&amp;&nbsp;</span><br style=""><span style="">ln -sf /etc/rc.d/rc.local /etc/rc.d/rc4.d/S999rc.local &amp;&amp;&nbsp;</span><br style=""><span style="">ln -sf /etc/rc.d/rc.local /etc/rc.d/rc5.d/S999rc.local &amp;&amp;&nbsp;</span><br style=""><span style="">ln -sf /etc/rc.d/rc.local /etc/rc.d/rc6.d/S999rc.local&nbsp;</span><br style=""><br style=""><span style="">5. 关于bash启动脚本&nbsp;</span><br style=""><br style=""><span style="">/etc/profile&nbsp;</span><br style=""><span style="">/etc/bashrc&nbsp;</span><br style=""><span style="">~/.bash_profile&nbsp;</span><br style=""><span style="">~/.bashrc&nbsp;</span><br style=""><span style="">是bash的启动脚本&nbsp;</span><br style=""><br style=""><span style="">一般用来设置单用户的启动环境，也可以实现开机单用户的程序，但要明确他们都是属于bash范畴而不是系统范畴。&nbsp;</span><br style=""><br style=""><span style="">他们的具体作用介绍如下：&nbsp;</span><br style=""><br style=""><span style="">/bin/bash这个命令解释程序(后面简称shell)使用了一系列启动文件来建立一个运行环境：&nbsp;</span><br style=""><br style=""><span style="">/etc/profile&nbsp;</span><br style=""><span style="">/etc/bashrc&nbsp;</span><br style=""><span style="">~/.bash_profile&nbsp;</span><br style=""><span style="">~/.bashrc&nbsp;</span><br style=""><span style="">~/.bash_logout&nbsp;</span><br style=""><span style="">每一个文件都有特殊的功用并对登陆和交互环境有不同的影响。&nbsp;</span><br style=""><span style="">/etc/profile 和 ~/.bash_profile 是在启动一个交互登陆shell的时候被调用。&nbsp;</span><br style=""><span style="">/etc/bashrc 和 ~/.bashrc 是在一个交互的非登陆shell启动的时候被调用。&nbsp;</span><br style=""><span style="">~/.bash_logout 在用户注销登陆的时候被读取&nbsp;</span><br style=""><br style=""><span style="">一个交互的登陆shell会在 /bin/login 成功登陆之后运行。一个交互的非登陆shell是通过命令行来运行的，如[prompt]$/bin/bash。一般一个非交互的shell出现在运行 shell脚本的时候。之所以叫非交互的shell，是因为它不在命令行上等待输入而只是执行脚本程序。&nbsp;</span><br style=""><br style=""><br style=""><span style="">6. 关于开机程序的自动启动&nbsp;</span><br style=""><span style="">系统脚本可以放置在/etc/rc.d/init.d中并建立/etc/rc.d/rc?.d链接，也可以直接放置在/etc/rc.d/rc.local中。&nbsp;</span><br style=""><span style="">init.d脚本包含完整的start,stop,status,reload等参数，是标准做法，推荐使用。&nbsp;</span><br style=""><span style="">为特定用户使用的程序（如有的用户需要使用中文输入法而有的不需要）放置在~/中的bash启动脚本中。</span><br style=""><span class="tpc_content" style="">下面用自启动apache为例;<br>自启动脚本:<br>/usr/local/apache2/bin；<br>./apachectl start<br>文件位于/etc/rc.d/init.d下,名为apached, 注意要可执行.<br>#chmod +x /etc/rc.d/init.d/apached &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //设置文件的属性为可执行<br>#ln -s /etc/rc.d/init.d/apached /etc/rc3.d/S90apache &nbsp; &nbsp; //建立软连接,快捷方式<br>#ln -s /etc/rc.d/init.d/apached /etc/rc0.d/K20apache</span><br style=""><br style=""><span style="">附录二：</span><span class="tpc_content" style="">在Red Hat Linux中自动运行程序</span><br style=""><span class="tpc_content" style=""><a style="color: #07519a; text-decoration: none;" href="http://www.newebug.com/article/unix-linux/1428.shtml" target="_blank">http://www.newebug.com/article/unix-linux/1428.shtml</a><br><br>在Red Hat Linux中自动运行程序<br>1．开机启动时自动运行程序<br>　　Linux加载后, 它将初始化硬件和设备驱动, 然后运行第一个进程init。init根据配置文件继续引导过程，启动其它进程。通常情况下，修改放置在 /etc/rc或 /etc/rc.d 或 /etc/rc?.d 目录下的脚本文件，可以使init自动启动其它程序。例如：编辑 /etc/rc.d/rc.local 文件，在文件最末加上一行"xinit"或"startx"，可以在开机启动后直接进入X－Window。<br><br>　　2．登录时自动运行程序<br>　　用户登录时，bash首先自动执行系统管理员建立的全局登录script ：/ect/profile。然后bash在用户起始目录下按顺序查找三个特殊文件中的一个：/.bash_profile、/.bash_login、 /.profile，但只执行最先找到的一个。<br>　　因此，只需根据实际需要在上述文件中加入命令就可以实现用户登录时自动运行某些程序（类似于DOS下的Autoexec.bat）。<br><br>　　3．退出登录时自动运行程序<br>　　退出登录时，bash自动执行个人的退出登录脚本/.bash_logout。例如，在/.bash_logout中加入命令"tar －cvzf c.source.tgz ＊.c"，则在每次退出登录时自动执行 "tar" 命令备份 ＊.c 文件。<br><br>　　4．定期自动运行程序<br>　　Linux有一个称为crond的守护程序，主要功能是周期性地检查 /var/spool/cron目录下的一组命令文件的内容，并在设定的时间执行这些文件中的命令。用户可以通过crontab 命令来建立、修改、删除这些命令文件。<br>　　例如，建立文件crondFile，内容为"00 9 23 Jan ＊ HappyBirthday"，运行"crontab cronFile"命令后，每当元月23日上午9:00系统自动执行"HappyBirthday"的程序（"＊"表示不管当天是星期几）。<br><br>　　5．定时自动运行程序一次<br>　　定时执行命令at 与crond 类似（但它只执行一次）：命令在给定的时间执行，但不自动重复。at命令的一般格式为：at [ －f file ] time ，在指定的时间执行file文件中所给出的所有命令。也可直接从键盘输入命令：<br><br>　　＄ at 12:00<br>　　at&gt;mailto Roger －s ″Have a lunch″ &lt; plan.txt<br>　　at&gt;Ctr－D<br>　　Job 1 at 2000－11－09 12:00</span></p>
<p>&nbsp;</p>
<p>【备注】 转自：&nbsp;<a href="http://www.xxlinux.com/linux/article/accidence/technique/20070719/9065.html">http://www.xxlinux.com/linux/article/accidence/technique/20070719/9065.html</a></p>